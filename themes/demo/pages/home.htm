title = "Home"
url = "/"
layout = "default"
is_hidden = 0
child_of = "mey_no_parent"
hide_crumb = 0
remove_crumb_trail = 0
crumb_disabled = 0

[session]
security = "user"
allowedUserGroups[] = "admin_level_3"
allowedUserGroups[] = "admin_level_2"
allowedUserGroups[] = "admin_level_1"
redirect = "login"
==
<?php
use Jiwon\Byapps\Models\HomeLayout;
use Jiwon\Byapps\Models\AppsData;

function onStart()
{
    $userId = BackendAuth::getUser()['id'];
    $this['nowDate'] = time();
    $recoreds = HomeLayout::where('user_cd','=',$userId)
        ->select('layout_name')
        ->orderBy('sequence')
        ->get();
    if(count($recoreds) == 0){
        $this['recoreds'] = array('layout1','layout2','layout3');
    }else{
        $temp = array();
        foreach($recoreds as $recored){
            $temp[] = $recored->layout_name;
        }
        $this['recoreds'] = $temp;
    }
    $this['appsData'] = AppsData::inRandomOrder()
        ->select('app_name')
        ->addSelect('app_icon')
        ->addSelect('end_time')
        ->limit(40)
        ->get();

    $this['func'] = new Class {
        public function dateFormat($val)
        {
           $dateString = date("Y-m-d", $val);
           return $dateString;
        }
    };
}
function onGetChartData()
{
    //샘플 데이터
    $result = array(
        'circle1' => array(
            array('무료',156),
            array('유료',350),
            array('관리',100),
        ),
        'circle2' => array(
            array('무료',134),
            array('유료',152),
            array('관리',100),
        ),
        'bar' => array(
            array('신규',223,200),
            array('연장',524,200),
            array('기타',85,300),
        ),
    );
    return $result;
}
function onLayoutChange()
{
    $userId = BackendAuth::getUser()['id'];
    $params = Input::all();
    foreach($params as $key => $value){
        unset($data);
        $temp = HomeLayout::where('user_cd','=',$userId)
            ->where('layout_name','=',$key)
            ->count();
        $data['sequence'] = $value;
        if($temp == 0){
            $data['layout_name'] = $key;
            $data['user_cd'] = $userId;
            HomeLayout::insert($data);
        }else{
            HomeLayout::where('user_cd','=',$userId)->where('layout_name','=',$key)->update($data);
        }
    }
}
?>
==
{% component 'session' %}
<div class="container" style="padding: 58px 50px;">
{% if not user %}
<h2><center>로그인하는페이지</center></h2>
{% elseif user %}
<div class="sortable">
  {% for record in recoreds %}
      {% if record == 'layout1' %}
        <li class="ui-state-default one" id="layout1">
            <div class="dragbox " >
                <h2 class="theme1"><b>주문요청</b> <span class="font-default">현황</span></h2>
                <div class="c_box_1">
                    <div class="circle1">
                        <p class="vertical_center">10</p>
                        <p class="c_box_1_font">주문접수</p>
                    </div>
                </div>
                <div class="c_box_1">
                    <div class="circle1">
                        <p class="vertical_center">10</p>
                        <p class="c_box_1_font">부가서비스접수</p>
                    </div>
                </div>
                <div class="c_box_1">
                    <div class="circle1">
                        <p class="vertical_center">10</p>
                        <p class="c_box_1_font">업데이트 접수</p>
                    </div>
                </div>
                <div class="c_box_1">
                    <div class="circle1">
                        <p class="vertical_center">10</p>
                        <p class="c_box_1_font">고객문의</p>
                    </div>
                </div>
                <div class="c_box_1">
                    <div class="circle1">
                        <p class="vertical_center">10</p>
                        <p class="c_box_1_font">1:1문의</p>
                    </div>
                </div>
            </div>
        </li>
      {% elseif record == 'layout2' %}
        <li class="ui-state-default" id="layout2">
            <div class="dragbox_hover row dragbox">
                <div class="col-md-3 col-xs-12">
                    <h2>앱 통계</h2>
                    <div id="app_stats"></div>
                </div>
                <div class="col-md-3 col-xs-12">
                    <h2>MA 통계</h2>
                    <div id="ma_stats"></div>
                </div>
                <div class="col-md-6 col-xs-12" class="dragbox_hover">
                    <h2>매출통계</h2>
                    <div id="sale_stats"></div>
                </div>
            </div>

        </li>
      {% elseif record == 'layout3' %}
        <li class="ui-state-default one" id="layout3">
             <div class="dragbox">
                <div class="row">
                    <div class="cal_box col-md-12 col-sm-12">
                        <h2>만료예정업체</h2>
                    </div>
                    <div class="cal_box col-md-12 col-sm-12">
                        <ul class="col-lg-6 col-xs-12 app_select">
                            <li>IOS 계정 만료</li>
                            <li>푸쉬 인증서만료</li>
                            <li>MA 서비스만료</li>
                        </ul>
                    </div>
                </div>
                <div class="row">
                  {% for appData in appsData %}
                    <div class='col-sm-3 {{ appData.end_time < nowDate ? "opacity" : "" }}'>
                        <img class='h-25 p-10 d-inline-block' src='http://byapps.co.kr/member/apps/{{ appData.app_icon }}' alt='{{ appData.app_name }}'>
                        <p>{{ func.dateFormat(appData.end_time) }}</p>
                    </div>
                  {% endfor %}
                </div>
                <div class="row">
                  {% for appData in appsData %}
                    <div class='col-sm-3 {{ appData.end_time < nowDate ? "opacity" : "" }}'>
                        <img class='h-25 p-10 d-inline-block' src='http://byapps.co.kr/member/apps/{{ appData.app_icon }}' alt='{{ appData.app_name }}'>
                        <p>{{ func.dateFormat(appData.end_time) }}</p>
                    </div>
                  {% endfor %}
                </div>
                <div class="row">
                  {% for appData in appsData %}
                    <div class='col-sm-3 {{ appData.end_time < nowDate ? "opacity" : "" }}'>
                        <img class='h-25 p-10 d-inline-block' src='http://byapps.co.kr/member/apps/{{ appData.app_icon }}' alt='{{ appData.app_name }}'>
                        <p>{{ func.dateFormat(appData.end_time) }}</p>
                    </div>
                  {% endfor %}
                </div>
            </div>
        </li>
      {% endif %}
  {% endfor %}
</div>

<!-- Pages -->


{% endif %}

</div>
